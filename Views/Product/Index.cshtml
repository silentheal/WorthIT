@model IEnumerable<WorthIt.Models.Product>
@{
    ViewBag.Title = "Index";
    string CategoryName = ViewBag.CategoryName;
}

<section class="container-fluid row" id="products-result-body">
    <div class="search-result-box">
        <p class="serach-result">@Model.Count() Results</p>
    </div>
    <div id="products-result">
        <div class="col-md-2 col-xs-12 product-sort-box" ng-controller="sort">
            <div class="sort-box col-md-12 col-xs-4 collapse-animate">
                <div class="sort-head" ng-click="collapseRating = !collapseRating">
                    <h3 class="sort-header">Rating
                    <span ng-show="collapseRating" class="glyphicon glyphicon-chevron-up right"></span>
                    <span ng-show="!collapseRating" class="glyphicon glyphicon-chevron-down right"></span>
                    </h3>
                </div>
                <div class="sort-list-box" ng-show="collapseRating">
                    <form class="form-group" action="/" method="post">
                        <div class="checkbox">
                            <label>
                                <a href="@Url.Action("Index", "Product", new { rating = 5 })">
                                    <input type="checkbox" value="5" />
                                    <span>&hearts;&hearts;&hearts;&hearts;&hearts;<span class="right">(@ViewBag.modelFilterByRating_5)</span></span>
                                </a>
                            </label>
                        </div>
                        <div class="checkbox">
                            <label>
                                <a href="@Url.Action("Index", "Product", new { rating = 4 })">
                                    <input type="checkbox" value="" />
                                    <span>&hearts;&hearts;&hearts;&hearts;<span class="right">(@ViewBag.modelFilterByRating_4)</span></span>
                                </a>
                            </label>
                        </div>
                        <div class="checkbox">
                            <label>
                                <a href="@Url.Action("Index", "Product", new { rating = 3 })">
                                    <input type="checkbox" value="" />
                                    <span>&hearts;&hearts;&hearts;<span class="right">(@ViewBag.modelFilterByRating_3)</span></span>
                                </a>
                            </label>
                        </div>
                        <div class="checkbox">
                            <label>
                                <a href="@Url.Action("Index", "Product", new { rating = 2 })">
                                    <input type="checkbox" value="" />
                                    <span>&hearts;&hearts;<span class="right">(@ViewBag.modelFilterByRating_2)</span></span>
                                </a>
                            </label>
                        </div>
                        <div class="checkbox">
                            <label>
                                <a href="@Url.Action("Index", "Product", new { rating = 1 })">
                                    <input type="checkbox" value="" />
                                    <span>&hearts;<span class="right">(@ViewBag.modelFilterByRating_1)</span></span>
                                </a>
                            </label>
                        </div>
                    </form>
                </div>
            </div>
            <div class="sort-box col-md-12 col-xs-4">
                <div class="sort-head" ng-click="collapsePrice = !collapsePrice">
                    <h3 class="sort-header">
                        Price
                        <span ng-show="collapsePrice" class="glyphicon glyphicon-chevron-up right"></span>
                        <span ng-show="!collapsePrice" class="glyphicon glyphicon-chevron-down right"></span>
                    </h3>
                </div>
                <div class="sort-list-box" ng-show="collapsePrice">
                    <form class="form-group" action="/" method="post">
                        <div class="checkbox">
                            <label>
                                <a href="@Url.Action("Index", "Product", new { minPrice = 10, maxPrice = 30 })">
                                    <input type="checkbox" value="" />
                                    <span>$10 - 30<span class="right">(@ViewBag.modelFilterByCost_1)</span></span>
                                </a>
                            </label>
                        </div>
                        <div class="checkbox">
                            <label>
                                <a href="@Url.Action("Index", "Product", new { minPrice = 30, maxPrice = 50 })">
                                    <input type="checkbox" value="" />
                                    <span>$30 - 50<span class="right">(@ViewBag.modelFilterByCost_2)</span></span>
                                </a>
                            </label>
                        </div>
                        <div class="checkbox">
                            <label>
                                <a href="@Url.Action("Index", "Product", new { minPrice = 50, maxPrice = 100 })">
                                    <input type="checkbox" value="" />
                                    <span>$50 - 100<span class="right">(@ViewBag.modelFilterByCost_3)</span></span>
                                </a>
                            </label>
                        </div>
                        <div class="checkbox">
                            <label>
                                <a href="@Url.Action("Index", "Product", new { minPrice = 100, maxPrice = 150 })">
                                    <input type="checkbox" value="" />
                                    <span>$100 - 150<span class="right">(@ViewBag.modelFilterByCost_4)</span></span>
                                </a>
                            </label>
                        </div>
                        <div class="checkbox">
                            <label>
                                <a href="@Url.Action("Index", "Product", new { minPrice = 150, maxPrice = 200 })">
                                    <input type="checkbox" value="" />
                                    <span>$150 - 200<span class="right">(@ViewBag.modelFilterByCost_5)</span></span>
                                </a>
                            </label>
                        </div>

                        <div class="form-inline align-center">
                            <div class="form-group">
                                <input class="form-control small-form" type="text" placeholder="$" maxlength="4" />
                                &ensp;to&ensp;
                                <input class="form-control small-form" type="text" placeholder="$" maxlength="4" />
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            @*<div class="sort-box col-md-12 col-xs-4">
                <div class="sort-head" ng-click="collapseManufacturer = !collapseManufacturer">
                    <h3 class="sort-header">
                        Manufacturer
                        <span ng-show="collapseManufacturer" class="glyphicon glyphicon-chevron-up right"></span>
                        <span ng-show="!collapseManufacturer" class="glyphicon glyphicon-chevron-down right"></span>
                    </h3>
                </div>
                <div class="sort-list-box" ng-show="collapseManufacturer">
                    <form class="form-group" action="/" method="post">
                        <div class="checkbox">
                            <label>
                                <input type="checkbox" value="" />
                                <span>Simson<span class="right">(100)</span></span>
                            </label>
                        </div>
                        <div class="checkbox">
                            <label>
                                <input type="checkbox" value="" />
                                <span>Michelle<span class="right">(100)</span></span>
                            </label>
                        </div>
                        <div class="checkbox">
                            <label>
                                <input type="checkbox" value="" />
                                <span>Daniel<span class="right">(100)</span></span>
                            </label>
                        </div>
                        <div class="checkbox">
                            <label>
                                <input type="checkbox" value="" />
                                <span>Metra<span class="right">(100)</span></span>
                            </label>
                        </div>
                        <div class="checkbox">
                            <label>
                                <input type="checkbox" value="" />
                                <span>Faker<span class="right">(100)</span></span>
                            </label>
                        </div>

                        <div class="form-inline align-center">
                            <div class="form-group">
                                <input class="form-control" type="text" placeholder="Insert name.." maxlength="20" />
                            </div>
                        </div>
                    </form>
                </div>
            </div>*@
        </div>
        <div class="col-md-10 col-xs-12 products-list-box" ng-controller="productList">
            @foreach (var product in Model)
            {
            <div class="product-box col-md-4 col-sm-2 col-xs-2">
                <a href="@Url.Action("Detail", "Product", new { id = product.Id, name = ViewBag.CategoryName })">
                    <div class="product-image-box">
                        @if (product.ProductImages.Any())
                        {
                            <img class="product-image" src="@product.ProductImages.First().ImagePath" />
                        }
                    </div>
                </a>
                <div class="product-desc-box relative">
                    <a href="@Url.Action("Detail", "Product", new { id = product.Id, name = ViewBag.CategoryName })">
                        <h1 class="product-name">@product.Name</h1>
                    </a>
                    <h4 class="product-manufacterer">by @(product.AspNetUser != null ? product.AspNetUser.UserName.Split('@')[0] : string.Empty)</h4>
                    <h3 class="product-rate">
                    @if (product.Reviews.Count() > 0)
                    {
                        for (int i = 0; i < product.Reviews.Average(x => x.Rating); i++)
                        { 
                           <span>&hearts;</span>
                        }
                        <span class="product-review">(@product.Reviews.Count(x => x.ProductId == product.Id))</span>
                    }
                    else
                    {
                        <span>Be a first Reviewer</span>
                    }
                    </h3>
                    
                    <h3 class="product-price">@product.Price.Value.ToString("C")</h3>
                    @if (product.ShippingPrice > 0m)
                    {
                        <h5 class="product-shipping">Shipping Price: @product.ShippingPrice.Value.ToString("C")</h5>
                    }
                    else
                    {
                        <h5 class="product-shipping">Free Shipping</h5>
                    }

                    <form class="form-group btn-cart">
                        <button class="btn btn-default btn-lg" ng-click="addToCart(@product.Id)">Add to cart</button>
                        @if (product.Inventory != 0)
                        {
                            @Html.ActionLink("Buy Now", "index", "cart", null, new { @class = "btn btn-success btn-lg" })
                        }
                        else
                        {
                            <button class="btn btn-success btn-lg btn-disable">Buy Now</button>
                        }

                    </form>
                </div>
            </div>
            }
        </div>
    </div>
</section>

